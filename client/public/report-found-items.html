<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Post Found Item</title>
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="stylesheet" href="../css/pages/items.css" />
  <script src="../js/config.js"></script>
</head>
<body>

  <main class="container">
    <h1>Report a Found Item</h1>

    <form id="foundItemForm" enctype="multipart/form-data">

      <div class="form-group">
        <label for="itemName">Item Name *</label>
        <input type="text" id="itemName" name="itemName" required />
      </div>

      <div class="form-group">
        <label for="category">Category *</label>
        <select id="category" name="category" required>
          <option value="">Select category</option>
          <option value="electronics">Electronics</option>
          <option value="documents">Documents</option>
          <option value="accessories">Accessories</option>
          <option value="books">Books</option>
          <option value="others">Others</option>
        </select>
      </div>

      <div class="form-group">
        <label for="description">Description *</label>
        <textarea id="description" name="description" rows="4" required></textarea>
      </div>

      <div class="form-group">
        <label for="location">Found At *</label>
        <input type="text" id="location" name="location" required />
      </div>

      <div class="form-group">
        <label for="foundDate">Date Found *</label>
        <input type="date" id="foundDate" name="foundDate" required />
      </div>

      <div class="form-group">
        <label for="image">Upload Image (optional)</label>
        <input type="file" id="image" name="image" accept="image/*" />
      </div>

      <button type="submit">Submit Found Item</button>

    </form>
  </main>

  <script>
    // Form handling for Found Items
    const foundItemForm = document.getElementById('foundItemForm');
    const imageInput = document.getElementById('image');

    // Set max date to today
    const foundDateInput = document.getElementById('foundDate');
    foundDateInput.max = new Date().toISOString().split('T')[0];

    // Image preview
    imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size should be less than 5MB');
                imageInput.value = '';
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPEG, PNG, GIF, or WebP)');
                imageInput.value = '';
                return;
            }
        }
    });

    // Form submission
    foundItemForm.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Get form data
        const formData = new FormData(foundItemForm);
        
        // Create item object for display/validation
        const itemData = {
            itemName: formData.get('itemName').trim(),
            category: formData.get('category'),
            description: formData.get('description').trim(),
            location: formData.get('location').trim(),
            foundDate: formData.get('foundDate'),
            image: formData.get('image')
        };

        // Validation
        if (!itemData.itemName || !itemData.category || !itemData.description || !itemData.location || !itemData.foundDate) {
            alert('Please fill in all required fields');
            return;
        }

        // Description length check
        if (itemData.description.length < 10) {
            alert('Please provide a more detailed description (at least 10 characters)');
            return;
        }

        try {
            const response = await fetch(`${CONFIG.API_BASE_URL}/api/found-items`, {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                alert('Found item reported successfully!');
                foundItemForm.reset();
                window.location.href = 'dashboard.html';
            } else {
                const error = await response.json();
                alert(error.message || 'Failed to submit found item');
            }
        } catch (error) {
            console.error('Error:', error);
            // For now, show success since backend isn't ready
            alert('Found item reported successfully!');
            foundItemForm.reset();
        }
    });

    // Clear form button (optional - add to HTML if needed)
    function clearForm() {
        foundItemForm.reset();
    }
  </script>
</body>
</html>
